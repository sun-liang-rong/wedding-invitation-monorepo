## 婚礼请帖 - 图片上传功能实施计划

### 1. 后端实现 (NestJS)

#### 1.1 安装依赖
```bash
cd apps/backend
npm install @types/multer --save-dev
```

#### 1.2 创建文件上传模块
- `src/upload/upload.controller.ts` - 文件上传接口
- `src/upload/upload.service.ts` - 文件存储服务
- `src/upload/upload.module.ts` - 上传模块
- `src/upload/dto/upload.dto.ts` - 上传 DTO

#### 1.3 新增 API 接口
- `POST /api/upload/cover` - 上传封面图片 (单文件)
- `POST /api/upload/gallery` - 上传相册图片 (多文件，最多6张)

#### 1.4 配置静态资源
- 在 `main.ts` 配置静态文件访问 `/uploads/**`
- 文件存储目录: `apps/backend/static/uploads`

#### 1.5 修改现有接口
- 更新 `CreateInvitationDto` 的验证规则
- 确保图片 URL 可以是相对路径或绝对路径

### 2. 前端实现 (Next.js)

#### 2.1 创建图片上传组件
- `components/ImageUploader.tsx` - 通用图片上传组件
- 支持拖拽上传
- 支持点击选择
- 图片预览功能
- 上传进度显示
- 删除/替换图片

#### 2.2 修改创建页面
- `app/page.tsx`:
  - 封面图片: 替换 URL 输入框为 ImageUploader
  - 相册展示: 替换 6 个 URL 输入框为 ImageUploader 列表
  - 实现先上传图片再提交表单的逻辑

#### 2.3 保持向后兼容
- 同时支持上传和 URL 输入两种方式
- 用户可自由选择

### 3. 文件存储策略

#### 存储结构
```
apps/backend/static/uploads/
├── cover/
│   └── {timestamp}-{random}.{ext}
└── gallery/
    └── {timestamp}-{random}.{ext}
```

#### 文件命名
- 格式: `{timestamp}-{random}.{ext}`
- 示例: `1704388800000-abc123.jpg`

#### 限制
- 支持格式: jpeg, jpg, png, webp
- 单文件大小: ≤ 5MB
- 相册数量: 最多 6 张

### 4. 实施步骤

1. 安装后端依赖
2. 创建后端上传模块和接口
3. 配置静态资源访问
4. 创建前端图片上传组件
5. 修改前端表单页面
6. 测试完整流程

### 5. 预期效果

- 用户可以直接上传本地图片
- 图片自动存储并生成访问 URL
- 前端展示不受影响
- 向后兼容现有 URL 输入方式